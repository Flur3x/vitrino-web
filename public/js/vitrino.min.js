function initMap(){mapboxgl.accessToken="pk.eyJ1IjoiZGFuaWVsYmlzY2hvZmYiLCJhIjoiY2l1enE4cWY1MDAyazJ4cDZxYjdramk2OCJ9.MUanhYSFZNfJZOjiLRWybw",map=new mapboxgl.Map({container:"map",style:"mapbox://styles/danielbischoff/citr5jj1b000d2irvg4mbic27"})}function initGeoSearch(){map.addControl(new mapboxgl.Geocoder({country:"de",placeholder:"Ort, Stra√üe, Hausnummer"}))}function loadAllMarkers(){VitrinoLib.Api.stores.getAll(function(a,b){var c=[];return a?console.error(a.stack):(console.log(b),b.forEach(function(a){var b=markerIcons[a.product_category];c.push({type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{id:a.id,company:a.company,description:a.description,logo_url:a.logo_url?a.logo_url:"",icon:b}})}),addSource(c),void addLayer())})}function addSource(a){map.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:a}})}function addLayer(){map.addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"{icon}","icon-offset":[0,-51],"icon-allow-overlap":!0}})}function initEventListeners(){map.once("load",function(){loadAllMarkers(),initGeoSearch()}),map.on("click",function(a){var b=map.queryRenderedFeatures(a.point,{layers:["points"]});if(!b.length)return void eventHub.$emit("mapClicked");var c=b[0];eventHub.$emit("markerClicked",{id:c.properties.id,company:c.properties.company,description:c.properties.description,logo_url:c.properties.logo_url})})}var VitrinoLib=VitrinoLib||{};VitrinoLib.Api=function(){var a={getAll:function(a){$.getJSON("/api/users/").done(function(b){a(null,b)}).fail(function(b,c,d){var d=c+", "+d;a(d,null)})}},b={getAll:function(a){$.getJSON("/api/companies/").done(function(b){a(null,b)}).fail(function(b,c,d){var d=c+", "+d;a(d,null)})},verify:function(a,b){$.post("/api/companies/"+a+"/verify").done(function(a){b(null,a)}).fail(function(a,c,d){var d=c+", "+d;b(d,null)})}},c={getAll:function(a){$.getJSON("/api/stores/").done(function(b){a(null,b)}).fail(function(b,c,d){var d=c+", "+d;a(d,null)})},getStoreWindowProducts:function(a,b){$.getJSON("/api/stores/"+a+"/products/window").done(function(a){b(null,a)}).fail(function(a,c,d){var d=c+", "+d;b(d,null)})}},d={getAll:function(a){$.getJSON("/api/products/").done(function(b){a(null,b)}).fail(function(b,c,d){var d=c+", "+d;a(d,null)})},verify:function(a,b){$.post("/api/products/"+a+"/verify").done(function(a){b(null,a)}).fail(function(a,c,d){var d=c+", "+d;b(d,null)})}};return{users:a,companies:b,stores:c,products:d}}(),Vue.component("store-window",{data:function(){return{show:!1,company:{name:"",description:"",logo_url:""},store:{id:""},products:{store_window:[]}}},watch:{"store.id":function(){const a=this;var b=a.products.store_window;b.splice(0,b.length),VitrinoLib.Api.stores.getStoreWindowProducts(a.store.id,function(a,c){c.forEach(function(a){a.image_url&&b.push({id:a.id,image_url:a.image_url})})})}},created:function(){const a=this;eventHub.$on("markerClicked",function(b){a.company.name=b.company,a.company.description=b.description,a.company.logo_url=b.logo_url,a.store.id=b.id,a.show=!0}),eventHub.$on("mapClicked",function(){a.show=!1})},destroyed:function(){eventHub.$off("markerClicked"),eventHub.$off("mapClicked")}});var map,markerIcons={1:"marker-clothes",2:"marker-jewellery",3:"marker-gifts",4:"marker-cosmetics",5:"marker-clothes",6:"marker-clothes",7:"marker-home",8:"marker-clothes"};window.mapboxgl&&!mapboxgl.supported()?console.log("Your browser doesn't support Mapbox GL."):window.mapboxgl&&0!==$("#map").length&&(initMap(),initEventListeners());